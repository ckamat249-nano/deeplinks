<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Button Alert App</title>
  <style>
    body, html {
      height: 100vh;
      margin: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #f5f5f5;
      font-family: sans-serif;
    }
    .container {
      display: flex;
      flex-direction: column; /* change to column for up/down navigation */
      gap: 2rem;
      align-items: center;
    }
    button {
      padding: 1rem 2rem;
      font-size: 1.2rem;
      cursor: pointer;
      border-radius: 8px;
      border: 2px solid #666;
      background: #fff;
      transition: background 0.2s, border 0.2s;
    }
    button:focus {
      outline: none;
      border-color: #1976d2;
      background: #e3f0ff;
    }
    button:hover {
      background: #f0f0f0;
    }
        /* Optional CSS to center the game wrapper */
        #game-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 50vh; /* Full height of the viewport */
        }
  </style>
  </head>
<body>
  <!-- align the buttons to left and push game container to right -->
  <div class="container" style="align-items: flex-start; width: 300px; margin-right: auto;">
    <button id="btn1" tabindex="0" onclick="firebolt_discovery('overlaylauncher:launchOverlay#overlayType=presModal&overlayName=BLE_OVERLAY&presentationSrc=%7BSTATIC_FILES_BASE_URL%7D%2Ffeeds%2Fx2%2Fsettings%2Faudio%2Fbluetooth_overlay.xml&defaultPackage=com.comcast.guide.presentation.view&backgroundColor=medium&isContainerizedOverlay=true')">BT Settings Firebolt</button>
    <button id="btn2" tabindex="1" onclick="$badger.deeplink('xre:///guide/x2/settings/audio/bluetooth.xml')">BT Settings Badger</button>
  </div>
  <div id="game-container"></div>
  <script>
    
    // Set focus to the first button on page load
    window.onload = function() {
      document.getElementById('btn1').focus();
    }

    // get gamepad input for accessibility navigation

    window.addEventListener("gamepadconnected", function(e) {
      console.log("Gamepad connected:", e.gamepad);
      // Share the connected gamepad with the entire page
      window.sharedPad = e.gamepad;
    });

    window.addEventListener("gamepaddisconnected", function(e) {
      console.log("Gamepad disconnected:", e.gamepad);
      // Clear shared pad if the disconnected one was the shared reference
      if (window.sharedPad && (window.sharedPad.id === e.gamepad.id || window.sharedPad.index === e.gamepad.index)) {
        window.sharedPad = null;
      }
    });

    let gamepadSet= new Set();
    function pollGamepad() {
      // Prefer a shared pad set by Phaser or the window event;
      // fallback to the first available raw Gamepad.
      let pad = window.sharedPad || null;
      if (!pad) {
        const gamepads = navigator.getGamepads ? navigator.getGamepads() : [];
        pad = gamepads.find(gp => gp) || null;
        if (pad) {
          window.sharedPad = pad;
        }
      }

      if (pad) {
        const isPhaserPad = (pad.A !== undefined) || (pad.leftStick !== undefined);
        const aPressed = isPhaserPad ? !!pad.A : !!(pad.buttons[0] && pad.buttons[0].pressed);
        const upPressed = isPhaserPad ? !!pad.up : !!(pad.buttons[12] && pad.buttons[12].pressed);
        const downPressed = isPhaserPad ? !!pad.down : !!(pad.buttons[13] && pad.buttons[13].pressed);
        const padKey = pad.id || pad.index || 'pad';

        if (aPressed) {
          if (!gamepadSet.has(padKey)) document.activeElement.click();
          gamepadSet.add(padKey);
        } else if (upPressed) {
          if (!gamepadSet.has(padKey)) moveFocus(-1);
          gamepadSet.add(padKey);
        } else if (downPressed) {
          if (!gamepadSet.has(padKey)) moveFocus(1);
          gamepadSet.add(padKey);
        } else {
          gamepadSet.delete(padKey);
        }
      }

      requestAnimationFrame(pollGamepad);
    }
    
    function moveFocus(direction) {
      const buttons = Array.from(document.querySelectorAll('button'));
      const currentIndex = buttons.indexOf(document.activeElement);
      let nextIndex = (currentIndex + direction + buttons.length) % buttons.length;
      buttons[nextIndex].focus();
    }

    pollGamepad();

    const buttons = Array.from(document.querySelectorAll('button'));
    buttons.forEach((btn, idx) => {
      btn.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          btn.click();
        } else if (e.key === 'ArrowDown') {
          e.preventDefault();
          const next = buttons[(idx + 1) % buttons.length];
          next.focus();
        } else if (e.key === 'ArrowUp') {
          e.preventDefault();
          const prev = buttons[(idx - 1 + buttons.length) % buttons.length];
          prev.focus();
        }
      });
    });
  </script>
  <script src="https://cdn.thor.comcast.com/sdk/money-badger.min.js"></script>
  <script src="./dist/bundle.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.min.js"></script>
  <script>
    // Phaser 3 basic setup
    class MyScene extends Phaser.Scene {
      constructor() {
        super({ key: 'MyScene' });
      }

      preload() {
        console.log('Preloading assets...');
        // Load assets here
        this.load.image('ball', 'https://mdn.github.io/shared-assets/images/examples/2D_breakout_game_Phaser/ball.png');
        this.load.image('paddle', 'https://mdn.github.io/shared-assets/images/examples/2D_breakout_game_Phaser/paddle.png');
      }

      create() {
        this.input.gamepad.once('connected', (pad) => {
          console.log('Gamepad connected:', pad.id);
          this.gamepad = pad;
          // Share the Phaser gamepad instance so main HTML can read it
          window.sharedPad = pad;
        });
        // Create game objects here
       this.ball = this.add.sprite(
          this.scale.width * 0.5,
          0,
          "ball",
        );
        this.paddle = this.add.sprite(this.scale.width * 0.5,
            this.scale.height - 5,
            "paddle",
          );
        this.paddle.setOrigin(0.5, 1);
        this.physics.add.existing(this.ball);
        this.physics.add.existing(this.paddle);
        this.ball.body.setCollideWorldBounds(true,1, 1);
        this.ball.body.setBounce(1, 1);
        this.ball.body.setVelocity(150, -150);
        this.ball.body.gravity.y = 500;
        this.paddle.body.setImmovable(true);
        this.ball.body.setBounce(1);
      }

      update() {
        // Game loop logic here
        // this.paddle.x = this.input.x;
        this.physics.collide(this.ball, this.paddle);
        if (this.gamepad) {
            let axisX = this.gamepad.leftStick.x;
            this.paddle.x += axisX * 5.0;
            this.paddle.x = Phaser.Math.Clamp(this.paddle.x, this.paddle.width * 0.5, this.scale.width - this.paddle.width * 0.5);
        } else {
            this.paddle.x = this.input.x || this.scale.width * 0.5;
        }
      }
    }

     const config = {
      type: Phaser.AUTO,
      parent: 'game-container',
      input: {
        gamepad: true
      },
      scale: {
        mode: Phaser.Scale.CENTER_BOTH,
        autoCenter: Phaser.Scale.CENTER_BOTH,
        width: 480,
        height: 360,
      },
      physics: {
        default: 'arcade',
      },
      backgroundColor: '#eeeeee',
      scene: MyScene
    };

    const game = new Phaser.Game(config);
    // place the game canvas inside the container div
  </script>
</body>
</html>
